name: Price Check Cron Job

# This workflow runs every 30 minutes to check product prices
on:
  schedule:
    # Runs every 30 minutes: */30 * * * *
    - cron: '*/30 * * * *'
  # Allow manual triggering from GitHub Actions tab
  workflow_dispatch:

jobs:
  price-check:
    runs-on: ubuntu-latest
    steps:
      - name: Call Price Check API
        run: |
          # Get your app URL from environment secrets or use your deployed URL
          APP_URL="${{ secrets.APP_URL || 'https://your-app.vercel.app' }}"
          CRON_SECRET="${{ secrets.CRON_SECRET }}"
          
          if [ -z "$CRON_SECRET" ]; then
            echo "⚠️ Warning: CRON_SECRET not set. The API endpoint should still work if it doesn't require authentication."
            curl -X GET "${APP_URL}/api/cron"
          else
            curl -X GET "${APP_URL}/api/cron?secret=${CRON_SECRET}"
          fi
          
      - name: Check Response
        run: |
          echo "✅ Price check completed at $(date)"

